{{/* ============================================================
File: blog_src/layouts/_default/list.html
Full path: C:\Users\vladi\Documents\blog.equalle.com\blog_src\layouts\_default\list.html
Purpose: Category and tag list page (renders posts within category)
============================================================ */}}

{{ define "main" }}
<main class="main list-page">
  {{- if not .IsHome }}
  <header class="list-page-header">
    <div class="equalle-hero">
      <img src="/images/logo-tags.webp" alt="{{ .Title }} – eQualle Blog" loading="lazy" decoding="async" class="hero-logo"/>
    </div>
    <h1 class="page-title">{{ .Title }}</h1>
    {{ with .Description }}
      <p class="page-description">{{ . }}</p>
    {{ end }}
  </header>
  {{- end }}

  {{/* --- Посты категории (включая fallback по Params.categories) --- */}}
  {{ $posts := .Pages }}
  {{ if not (gt (len $posts) 0) }}
    {{/* Если Hugo не связал таксономию — ищем вручную по Params.categories */}}
    {{ $catName := .Title | lower }}
    {{ $all := where site.RegularPages "Type" "!=" "page" }}
    {{ $posts = where $all "Params.categories" "intersect" (slice .Title) }}
    {{ if not (gt (len $posts) 0) }}
      {{/* Вторичная проверка по нижнему регистру */}}
      {{ $posts = where $all "Params.categories" "intersect" (slice $catName) }}
    {{ end }}
  {{ end }}
  {{ $p := .Paginate $posts }}

  {{ if $p.Pages }}
  <section class="list-cards">
    {{ range $p.Pages }}
    <article class="card-item">
      <a href="{{ .RelPermalink }}" class="card-link">
        <h2 class="card-title">{{ .Title }}</h2>
        <div class="card-meta">
          {{ with .Params.tags }}
            <div class="tags">
              {{ range . }}
                <span class="tag">#{{ . }}</span>
              {{ end }}
            </div>
          {{ end }}
        </div>
        {{ with .Summary }}
        <p class="card-summary">{{ . | plainify | truncate 240 }}</p>
        {{ end }}
        <div class="card-footer">
          <span>
            {{ .Date.Format "January 2, 2006" }} · {{ .ReadingTime }} min read
            {{- with .Params.author }} · by {{ . }}{{ end }}
            {{- with .Params.categories }}
             · in {{ index . 0 }}
            {{- end }}

          </span>
        </div>
      </a>
    </article>
    {{ end }}
  </section>

  {{ if gt $p.TotalPages 1 }}
    {{ partial "pagination.html" $p }}
  {{ end }}

  {{ else }}
    <p>No posts found.</p>
  {{ end }}
</main>

<style>
.list-page-header {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: .85rem;
  text-align: left;
  padding: 1.25rem 1.5rem;
  background: linear-gradient(135deg, var(--brand-blue, #0d4f8b), var(--brand-cyan, #0097a7));
  color: #fff;
  border-radius: 14px;
  box-shadow: 0 6px 24px rgba(0,0,0,.25);
  margin: 0 auto 2rem auto;
  max-width: var(--main-width);
  width: 100%;
}
.list-page-header .page-title {
  font-size: 1.9rem;
  margin: 0;
  font-weight: 800;
  letter-spacing: -0.02em;
  line-height: 1.2;
}
.list-page-header .page-description {
  color: #e5f7ff;
  font-size: 1rem;
  margin-top: .35rem;
}
.equalle-hero {
  flex: 0 0 auto;
}
.equalle-hero .hero-logo {
  width: 84px;
  height: 84px;
  border-radius: 20%;
  background: radial-gradient(circle at center, rgba(255,255,255,.15) 0%, rgba(255,255,255,.05) 100%);
  box-shadow: 0 4px 16px rgba(0,0,0,.25);
}

.list-cards {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
}
@media (min-width: 860px) {
  .list-cards { grid-template-columns: repeat(2, 1fr); }
}

.card-item {
  background: var(--brand-card, #0e1420);
  border-radius: 14px;
  box-shadow: 0 4px 16px rgba(0,0,0,.3);
  overflow: hidden;
  transition: transform .25s ease, box-shadow .25s ease;
}
.card-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,.4);
}
.card-link {
  display: flex;
  flex-direction: column;
  height: auto;
  text-decoration: none;
  color: var(--content, #e5e9f0);
  padding: 1.5rem 1.75rem;
}
.card-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--link-color, #1f6feb);
  margin: 0 0 .6rem 0;
  line-height: 1.35;
  overflow-wrap: break-word;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.card-meta {
  display: flex;
  flex-wrap: wrap;
  gap: .4rem .8rem;
  font-size: .8rem;
  color: var(--secondary, #9ca3af);
  margin-bottom: .65rem;
}
.tags, .categories {
  display: flex;
  flex-wrap: wrap;
  gap: .35rem;
  max-width: 100%;
  overflow-wrap: anywhere;
}
.tag, .cat {
  background: rgba(255,255,255,.08);
  border-radius: 6px;
  padding: .12rem .45rem;
  font-weight: 500;
  color: #d6e4ff;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}
.cat {
  background: rgba(255,255,255,.12);
  color: #b5f3ff;
  overflow-wrap: break-word;
  word-break: break-word;
}
.card-summary {
  font-size: .9rem;
  color: var(--tertiary, #aab1bd);
  line-height: 1.5;
  margin: .5rem 0 1rem 0;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
}
.card-footer {
  font-size: .8rem;
  color: var(--secondary, #9ca3af);
  margin-top: auto;
  opacity: .9;
  line-height: 1.5;
  white-space: normal;
  word-break: normal;
}
.card-footer a {
  color: var(--link-color, #1f6feb);
  text-decoration: none;
  border-bottom: 1px dashed rgba(255,255,255,.25);
}
.card-footer a:hover {
  border-bottom-color: rgba(255,255,255,.55);
}
@media (max-width: 640px) {
  .list-page-header {
    flex-direction: column;
    text-align: center;
    gap: .6rem;
    padding: 1rem;
    max-width: 92%;
  }
  .equalle-hero .hero-logo {
    width: 72px;
    height: 72px;
  }
  .list-page-header .page-title {
    font-size: 1.6rem;
  }
}
/* Light theme tweaks (do not affect dark mode) */
body:not(.dark) .list-page-header{
  background: linear-gradient(135deg, #eaf4fb, #7fcbe8);
  color:#0f172a;
  box-shadow: 0 4px 16px rgba(0,0,0,.10);
}
body:not(.dark) .list-page-header .page-title{
  color:#0b3f5f;
}

body:not(.dark) .equalle-hero .hero-logo{
  background: radial-gradient(circle at center, #ffffff 0%, #f3f7fb 100%);
  box-shadow: 0 2px 8px rgba(0,0,0,.12);
  border: 1px solid rgba(0,0,0,.06);
}

body:not(.dark) .card-item{
  background:#ffffff;
  border: 1px solid #e6edf5;
  box-shadow: 0 4px 14px rgba(0,0,0,.08);
}
body:not(.dark) .card-link{ color:#1f2937; }

body:not(.dark) .card-title{ color:#0b5cad; }

body:not(.dark) .card-meta{ color:#6b7280; }

body:not(.dark) .card-summary{ color:#4b5563; }

body:not(.dark) .tag,
body:not(.dark) .cat{
  background: rgba(0,0,0,.06);
  border: 1px solid rgba(0,0,0,.06);
  color:#365269;
}

body:not(.dark) .card-footer{
  color:#6b7280;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
body:not(.dark) .card-footer a{
  color:#0b5cad;
  border-bottom: 1px dashed rgba(0,0,0,.25);
}

/* === TAG PAGE HEADER — компактный круг справа === */
.list-page-header {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  gap: 1rem;
  padding: 1.5rem 2rem;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--brand-blue, #0d4f8b), var(--brand-cyan, #0097a7));
  color: #fff;
  box-shadow: 0 6px 24px rgba(0,0,0,.25);
  max-width: var(--main-width);
  margin: 0 auto 2rem auto;
  text-align: center;
}

.list-page-header .page-title {
  flex: 1;
  font-size: 1.8rem;
  font-weight: 800;
  margin: 0 auto;
  letter-spacing: -0.02em;
  line-height: 1.25;
}

/* === HERO LOGO RIGHT === */
.equalle-hero {
  position: absolute;
  right: 1.75rem;
  top: 50%;
  transform: translateY(-50%);
}

/* === УМЕНЬШЕННЫЙ КРУГ с равными параметрами для обеих тем === */
.equalle-hero .hero-logo {
  width: 92px;           /* уменьшено с 120px */
  height: 92px;
  border-radius: 50%;
  object-fit: contain;
  padding: 6px;          /* создаёт аккуратный отступ между краем и картинкой */
  background: radial-gradient(circle at center, #ffffff 0%, #f4f7fa 100%);
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 3px 10px rgba(0,0,0,.15);
  transition: all .25s ease;
}

/* === В ТЁМНОЙ ТЕМЕ — те же размеры, чуть темнее фон и тень === */
body.dark .equalle-hero .hero-logo {
  background: radial-gradient(circle at center, #161b22 0%, #0e1116 100%);
  border: 1px solid rgba(255,255,255,.05);
  box-shadow: 0 3px 10px rgba(0,0,0,.6);
}

/* === МОБИЛЬНАЯ ВЕРСИЯ === */
@media (max-width: 640px) {
  .list-page-header {
    flex-direction: column;
    text-align: center;
    padding: 1.25rem 1rem;
  }
  .equalle-hero {
    position: static;
    transform: none;
    margin-top: 1rem;
  }
  .equalle-hero .hero-logo {
    width: 80px;
    height: 80px;
    padding: 5px;
  }
}

</style>
{{ end }}
